name: Simple Release

# This is a simpler alternative that just creates a tar and attaches it to the release
# GitHub will automatically create a release when you push a tag

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Create release archive
        run: |
          VERSION=${GITHUB_REF#refs/tags/v}
          # Create archive in parent directory to avoid "file changed" error
          tar -czf "../git-pm-${VERSION}.tar.gz" \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='test-workspace' \
            --exclude='simple-test' \
            .
          # Move archive back
          mv "../git-pm-${VERSION}.tar.gz" .
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: git-pm-*.tar.gz
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
